var Mark={_copy:function(d){var e,c=[];for(e in d){c[e]=d[e]}return c},includes:{}};Mark.up=function(u,d,g){d=d||{};var m=u.match(/\{\{\w*[^}]+\w*\}\}/g)||[],v,c,f,j=[],r,e,h,n,l,p=0,k,t,s;if(g){for(k in g.pipes){Mark.pipes[k]=g.pipes[k]}for(k in g.includes){Mark.includes[k]=g.includes[k]}}function o(x,w){var i=w.shift(),b,a;if(i){b=i.split(">").shift().trim();a=i.split(">").splice(1);return o(Mark.pipes[b].apply(null,[x].concat(a)),w)}return x}function q(b,i,a){return b!==false?Mark.up(i,a):""}while((v=m[p++])){r=v.indexOf("/}}")>-1;f=v.substr(2,v.length-(r?5:4));e=f.indexOf("if ")===0;j=f.split("|").splice(1);f=f.replace(/^if/,"").split("|").shift().trim();c="{{/"+(e?"if":f.split("|")[0])+"}}";h="";l=undefined;if(!r&&m.indexOf(c,p)>-1){p=m.indexOf(c,p)+1;t=u.indexOf(v);s=u.indexOf(c);h=u.substring(t+v.length,s);v=u.substring(t,s+c.length)}if(Mark.includes[f]){l=o(Mark.up(Mark.includes[f],d),j)}else{if(f==="."){l=o(d,j)}else{if((f=f.split(".")).length>1){for(k=0,n=d;k<f.length;k++){n=n[f[k]]}l=o(n,j);if(e){l=q(l,h,d)}}else{if(d.hasOwnProperty(f)){if(e){l=q(o(d[f],j),h,d)}else{if(d[f] instanceof Array){l=n=o(d[f],j);if(n instanceof Array){l="";for(k in n){l+=h?Mark.up(h,n[k]):n[k]}}}else{if(h){l=Mark.up(h,d[f])}else{l=o(d[f],j)}}}}}}}u=u.replace(v,l===undefined?"???":l)}return u};Mark.pipes={blank:function(b,a){return !!b||b===0?b:a},empty:function(a){return !a||(a+"").trim().length===0?a:false},notempty:function(a){return a&&(a+"").trim().length?a:false},more:function(d,c){return(d instanceof Array?d.length:d)>c?d:false},less:function(d,c){return(d instanceof Array?d.length:d)<c?d:false},ormore:function(d,c){return(d instanceof Array?d.length:d)>=c?d:false},orless:function(d,c){return(d instanceof Array?d.length:d)<=c?d:false},equals:function(d,c){return d.toString()===c.toString()?d:false},notequals:function(d,c){return d.toString()!==c.toString()?d:false},like:function(b,a){return new RegExp(a).test(b)?b:false},notlike:function(b,a){return !Mark.pipes.like(b,a)?b:false},upcase:function(a){return String(a).toUpperCase()},downcase:function(a){return String(a).toLowerCase()},chop:function(a,b){return a.length>b?a.substr(0,b)+"...":a},trim:function(a){return a.trim()},pack:function(a){return a.trim().replace(/\s{2,}/g," ")},round:function(a){return Math.round(parseFloat(a))},style:function(b,a){return'<span class="'+a+'">'+b+"</span>"},clean:function(a){return String(a).replace(/<\/?[^>]+>/gi,"")},sub:function(c,b,a){return String(c).replace(new RegExp(b,"g"),a)},size:function(a){return a.length},length:function(a){return a.length},reverse:function(a){return Mark._copy(a).reverse()},join:function(a,b){return a.join(b)},limit:function(a,b){return a.slice(0,b)},slice:function(a,c,b){return a.slice(c,parseInt(c,0)+parseInt(b,0))},split:function(b,a){return b.split(a||",")},choose:function(b,c,a){return !!b?c:a},sort:function(a,c){var b=function(e,d){return e[c]>d[c]};return Mark._copy(a).sort(c?b:undefined)},fix:function(a,b){return a.toFixed(b)},url:function(a){return encodeURI(a)},call:function(b,a){return b[a].apply(b,[].slice.call(arguments,2))}};