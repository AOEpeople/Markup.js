var Mark={_copy:function(d,c){c=c||[];for(var e in d){c[e]=d[e]}return c},_size:function(b){return b instanceof Array?b.length:b},includes:{}};Mark.up=function(v,d,g){d=d||{};var m=v.match(/\{\{\w*[^}]+\w*\}\}/g)||[],w,c,f,j=[],s,e,h,n,l,q=0,k,u,t;if(g){Mark._copy(g.pipes,Mark.pipes);Mark._copy(g.includes,Mark.includes)}function p(y,x){var i=x.shift(),b,a;if(i){b=i.split(">").shift().trim();a=i.split(">").splice(1);return p(Mark.pipes[b].apply(null,[y].concat(a)),x)}return y}function r(b,z,y,x){var i=z.split("{{else}}");if(e){return Mark.up(b!==false?i[0]:i[1]||"",y,x)}return b}function o(a,b){this.idx=a;this.size=b;this.sign="#"}o.prototype=new Number();o.prototype.toString=o.prototype.valueOf=function(){return this.idx+this.sign.length-1};while((w=m[q++])){s=w.indexOf("/}}")>-1;f=w.substr(2,w.length-(s?5:4));e=f.indexOf("if ")===0;j=f.split("|").splice(1);f=f.replace(/^if/,"").split("|").shift().trim();c="{{/"+(e?"if":f.split("|")[0])+"}}";h="";l=undefined;if(!s&&m.indexOf(c,q)>-1){q=m.indexOf(c,q)+1;u=v.indexOf(w);t=v.indexOf(c);h=v.substring(u+w.length,t);w=v.substring(u,t+c.length)}if(Mark.includes[f]){l=p(Mark.up(Mark.includes[f],d),j)}else{if(f==="."){l=r(p(d,j),h,d)}else{if(f==="#"||f==="##"){g.iter.sign=f;l=r(p(g.iter,j),h,d,g)}else{if((f=f.split(".")).length>1){for(k=0,n=d;k<f.length;k++){n=n[f[k]]}l=r(p(n,j),h,d)}else{if(d.hasOwnProperty(f)){if(e){l=r(p(d[f],j),h,d)}else{if(d[f] instanceof Array){l=n=p(d[f],j);if(n instanceof Array){l="";for(k in n){l+=h?Mark.up(h,n[k],{iter:new o(+k,n.length)}):n[k]}}}else{if(h){l=Mark.up(h,d[f])}else{l=p(d[f],j)}}}}}}}}v=v.replace(w,l===undefined?"???":l)}return v};Mark.pipes={blank:function(b,a){return !!b||b===0?b:a},empty:function(a){return !a||(a+"").trim().length===0?a:false},notempty:function(a){return a&&(a+"").trim().length?a:false},more:function(d,c){return Mark._size(d)>c?d:false},less:function(d,c){return Mark._size(d)<c?d:false},ormore:function(d,c){return Mark._size(d)>=c?d:false},orless:function(d,c){return Mark._size(d)<=c?d:false},between:function(e,d,f){e=Mark._size(e);return e>=d&&e<=f?e:false},equals:function(d,c){return d.toString()===c.toString()?d:false},notequals:function(d,c){return d.toString()!==c.toString()?d:false},like:function(b,a){return new RegExp(a).test(b)?b:false},notlike:function(b,a){return !Mark.pipes.like(b,a)?b:false},upcase:function(a){return String(a).toUpperCase()},downcase:function(a){return String(a).toLowerCase()},chop:function(a,b){return a.length>b?a.substr(0,b)+"...":a},trim:function(a){return a.trim()},pack:function(a){return a.trim().replace(/\s{2,}/g," ")},round:function(a){return Math.round(+(a))},style:function(b,a){return'<span class="'+a+'">'+b+"</span>"},clean:function(a){return String(a).replace(/<\/?[^>]+>/gi,"")},sub:function(c,b,a){return String(c).replace(new RegExp(b,"g"),a)},size:function(a){return a.length},length:function(a){return a.length},reverse:function(a){return Mark._copy(a).reverse()},join:function(a,b){return a.join(b)},limit:function(a,b){return a.slice(0,b)},slice:function(a,c,b){return a.slice(c,parseInt(c,0)+parseInt(b,0))},split:function(b,a){return b.split(a||",")},choose:function(b,c,a){return !!b?c:a},sort:function(a,c){var b=function(e,d){return e[c]>d[c]?1:-1};return Mark._copy(a).sort(c?b:undefined)},fix:function(a,b){return(+a).toFixed(b)},mod:function(a,b){return(+a)%(+b)},divisible:function(a,b){return a!==false&&a%b===0?a:false},even:function(a){return a!==false&&a%2===0?a:false},odd:function(a){return a!==false&&a%2===1?a:false},url:function(a){return encodeURI(a)},bool:function(a){return !!a},falsy:function(a){return !a},first:function(a){return a.idx===0},last:function(a){return a.idx===a.size-1},call:function(b,a){return b[a].apply(b,[].slice.call(arguments,2))}};